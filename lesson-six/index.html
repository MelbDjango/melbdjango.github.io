
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Reveal.js</title>
        <link rel="stylesheet" href="/lesson-six/css/reveal.css">
        <link rel="stylesheet" href="/lesson-six/theme/melbdjango.css" id="theme">
        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="/lesson-six/lib/css/zenburn.css">
    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section  data-markdown><script type="text/template">## MelbDjango School

### Lesson Six â€” Testing
</script></section><section  data-markdown><script type="text/template">
## WIFI

Common Code / cc&20!4@
</script></section><section  data-markdown><script type="text/template">
## What is Testing?

- Process to validate the behavior a software component
- Execution of software with (arbitrary) input and expected results
</script></section><section  data-markdown><script type="text/template">
## Why Testing?

- To find bugs
- To find security issues
- To prevent regressions
- To have confidence in your work? (99% test coverage)
- To execute your code during development
</script></section><section  data-markdown><script type="text/template">
## How to Test?

- Give the software to people
- Write the program and then write other software (tests) that checks the program for expected results
- Write the tests first based on expected results, then write the program (or parts thereof)
</script></section><section  data-markdown><script type="text/template">
## Testing in Django

- Python `unittest` 2
- There are other tools:
  - pytest
  - nose
</script></section><section  data-markdown><script type="text/template">
## `django.test.SimpleTestCase`

- Django's base test class
- Unittest 2 `TestCase` subclass: https://docs.python.org/3.4/library/unittest.html
- Provides a lot of helpers:
  - Testing form field rendering and error treatment
  - Verifying a HTTP redirect is performed
  - Robustly testing two HTML fragments for equality/inequality or containment
  - Test client for testing views
  - ... and much more
  - NO! database access
- [https://docs.djangoproject.com/en/1.8/topics/testing/tools/](https://docs.djangoproject.com/en/1.8/topics/testing/tools/#simpletestcase)
</script></section><section  data-markdown><script type="text/template">
```python
from django.test import SimpleTestCase

class ExampleTest(SimpleTestCase):

  def test_raised_exception(self):
    with self.assertRaisesMessage(ValueError,
        'invalid literal for int()'):
      int('a')

  def test_html(self):
    self.assertHTMLEqual(
      '<input type="checkbox" checked="checked" id="id_acceptterms" />',
      '<input id="id_acceptterms" type="checkbox" checked>'
    )
```
</script></section><section  data-markdown><script type="text/template">
## `d.t.TestCase`

- All the features of `d.t.SimpleTestCase`
- Allows use of database
- Database transactions are **prohibited** inside
- `setUpTestData()` for initial data for the entire test case (new in 1.8)
- [https://docs.djangoproject.com/en/1.8/topics/testing/tools/](https://docs.djangoproject.com/en/1.8/topics/testing/tools/#testcase)
</script></section><section  data-markdown><script type="text/template">
```python
from django.contrib.auth import authenticate
from django.contrib.auth.models import User
from django.test import TestCase

class ExampleTest(TestCase):

  @classmethod
  def setUpTestData(cls):
    cls.admin = User.objects.create_superuser(
      'admin', 'admin@example.com', 'P4ssw0rd'
    )

  def test_authenticate(self):
    self.assertIs(
      authenticate(username='admin', password='P4ssw0rd'),
      self.user
    )
    self.assertIsNone(
      authenticate(username='admin', password='Wr0ng')
    )
```
</script></section><section  data-markdown><script type="text/template">
## `d.t.TransactionTestCase`

- All the features of `d.t.SimpleTestCase`
- Allows use of database
- Database transactions are **allowed** inside
- [https://docs.djangoproject.com/en/1.8/topics/testing/tools/](https://docs.djangoproject.com/en/1.8/topics/testing/tools/#transactiontestcase)
</script></section><section  data-markdown><script type="text/template">
## Test `Client`

- Easy way to test views
- [https://docs.djangoproject.com/en/1.8/topics/testing/tools/](https://docs.djangoproject.com/en/1.8/topics/testing/tools/#default-test-client)

```python
from django.test import TestCase

class ViewTest(TestCase):

  def test_details(self):
    response = self.client.get('/customer/details/')
    self.assertEqual(response.status_code, 200)

  def test_create(self):
    data = {'name': 'Some Client'}
    response = self.client.post(
      '/customer/create/', data, follow=True
    )
    self.assertRedirects(response, '/customers/', 302, 200)
```

</script></section><section  data-markdown><script type="text/template">
## Naming Things

- Files need to be named `test*.py`
  - Convention: `test_*.py`, e.g `test_models.py`
- Classes inside those files that inherit from `unittest.TestCase` (all of Django's test case classes)
  - Convention `ModelTests` or `TestModels` (pluralized)
- Methods inside those functions that start with `test`
  - Convention: `test_*`, e.g. `test_user_login`
</script></section><section  data-markdown><script type="text/template">
## Last Week's Homework

- Last week's solution in lesson-five repo (bootstrappy)
</script></section><section  data-markdown><script type="text/template">
## This week's Homework

- Fork https://github.com/MelbDjango/lesson-six
- Clone the repo to your own machine
- Use the virtualenv you created in previous lesson
- Add tests for the views using the Django's test client
- Bonus 1: Add tests to check for the string representation of your model instances
- Bonus 2: Add separate tests for the forms
</script></section><section  data-markdown><script type="text/template">
## References

- TODO
</script></section></div>
        </div>

        <script src="/lesson-six/lib/js/head.min.js"></script>
        <script src="/lesson-six/js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: '/lesson-six/lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: '/lesson-six/plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: '/lesson-six/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: '/lesson-six/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: '/lesson-six/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
              { src: '/lesson-six/plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default',
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {};
            options = extend(defaultOptions, options, queryOptions);
            Reveal.initialize(options);
        </script>
    </body>
</html>
